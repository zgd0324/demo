/** layui-v2.5.5 MIT License By https://www.layui.com */
layui.define("form",function(exports){var $=layui.$,form=layui.form,layer=layui.layer,MOD_NAME="tree",tree={config:{},index:layui[MOD_NAME]?layui[MOD_NAME].index+10000:0,set:function(options){var that=this;that.config=$.extend({},that.config,options);return that},on:function(events,callback){return layui.onevent.call(this,MOD_NAME,events,callback)},},thisModule=function(){var that=this,options=that.config,id=options.id||that.index;thisModule.that[id]=that;thisModule.config[id]=options;return{config:options,reload:function(options){that.reload.call(that,options)},getChecked:function(){return that.getChecked.call(that)},setChecked:function(id){return that.setChecked.call(that,id)},lazytree:function(elem,children){return that.tree.lazytree(that,elem,children)},}},getThisModuleConfig=function(id){var config=thisModule.config[id];if(!config){hint.error("The ID option was not found in the "+MOD_NAME+" instance")}return config||null},SHOW="layui-show",HIDE="layui-hide",NONE="layui-none",DISABLED="layui-disabled",ELEM_VIEW="layui-tree",ELEM_SET="layui-tree-set",ICON_CLICK="layui-tree-iconClick",ICON_ADD="layui-icon-addition",ICON_SUB="layui-icon-subtraction",ELEM_ENTRY="layui-tree-entry",ELEM_MAIN="layui-tree-main",ELEM_TEXT="layui-tree-txt",ELEM_PACK="layui-tree-pack",ELEM_SPREAD="layui-tree-spread",ELEM_LINE_SHORT="layui-tree-setLineShort",ELEM_SHOW="layui-tree-showLine",ELEM_EXTEND="layui-tree-lineExtend",ELEM_INIT=".layui-tree-init",Class=function(options){var that=this;that.index=++tree.index;that.config=$.extend({},that.config,tree.config,options);that.render()};Class.prototype.config={data:[],showCheckbox:false,showLine:true,accordion:false,onlyIconControl:false,isJump:false,edit:false,loading:true,text:{defaultNodeName:"未命名",none:"无数据"},};Class.prototype.reload=function(options){var that=this;layui.each(options,function(key,item){if(item.constructor===Array){delete that.config[key]}});that.config=$.extend(true,{},that.config,options);that.render()};Class.prototype.render=function(){var that=this,options=that.config;that.checkids=[];var temp=$('<div class="layui-tree'+(options.showCheckbox?" layui-form":"")+(options.showLine?" layui-tree-line":"")+'" lay-filter="LAY-tree-'+that.index+'"></div>');that.tree(temp);var othis=(options.elem=$(options.elem));if(!othis[0]){return}that.key=options.id||that.index;that.elem=temp;that.elemNone=$('<div class="layui-tree-emptyText">'+options.text.none+"</div>");othis.html(that.elem);if(that.elem.find(".layui-tree-set").length==0){return that.elem.append(that.elemNone)}if(options.showCheckbox){that.renderForm("checkbox")}that.elem.find(".layui-tree-set").each(function(){var othis=$(this);if(!othis.parent(".layui-tree-pack")[0]){othis.addClass("layui-tree-setHide")}if(!othis.next()[0]&&othis.parents(".layui-tree-pack").eq(1).hasClass("layui-tree-lineExtend")){othis.addClass(ELEM_LINE_SHORT)}if(!othis.next()[0]&&!othis.parents(".layui-tree-set").eq(0).next()[0]){othis.addClass(ELEM_LINE_SHORT)}});that.events()};Class.prototype.renderForm=function(type){form.render(type,"LAY-tree-"+this.index)};Class.prototype.tree=function(elem,children){var that=this,options=that.config,data=children||options.data;layui.each(data,function(index,item){var hasChild=item.children&&item.children.length>0,packDiv=$('<div class="layui-tree-pack" '+(item.spread?'style="display: block;"':"")+'"></div>'),entryDiv=$(['<div data-id="'+item.id+'" class="layui-tree-set'+(item.spread?" layui-tree-spread":"")+(item.checked?" layui-tree-checkedFirst":"")+'">','<div class="layui-tree-entry">','<div class="layui-tree-main">',(function(){if(options.showLine){if(hasChild||item.lazy){return('<span class="layui-tree-iconClick layui-tree-icon"><i class="layui-icon '+(item.spread?"layui-icon-subtraction":"layui-icon-addition")+'"></i></span>')}else{return'<span class="layui-tree-iconClick"><i class="layui-icon layui-icon-file"></i></span>'}}else{return('<span class="layui-tree-iconClick"><i class="layui-tree-iconArrow '+(hasChild?"":HIDE)+'"></i></span>')}})(),(function(){return options.showCheckbox?'<input type="checkbox" name="'+(item.field||"layuiTreeCheck_"+item.id)+'" same="layuiTreeCheck" lay-skin="primary" '+(item.disabled?"disabled":"")+' value="'+item.id+'">':""})(),(function(){if(options.isJump&&item.href){return('<a href="'+item.href+'" target="_blank" class="'+ELEM_TEXT+'">'+(item.title||item.label||options.text.defaultNodeName)+"</a>")}else{return('<span class="'+ELEM_TEXT+(item.disabled?" "+DISABLED:"")+'">'+(item.title||item.label||options.text.defaultNodeName)+"</span>")}})(),"</div>",(function(){if(!options.edit){return""}var editIcon={add:'<i class="layui-icon layui-icon-add-1"  data-type="add"></i>',update:'<i class="layui-icon layui-icon-edit" data-type="update"></i>',del:'<i class="layui-icon layui-icon-delete" data-type="del"></i>',},arr=['<div class="layui-btn-group layui-tree-btnGroup">',];if(options.edit===true){options.edit=["update","del"]}if(typeof options.edit==="object"){layui.each(options.edit,function(i,val){arr.push(editIcon[val]||"")});return arr.join("")+"</div>"}})(),"</div></div>",].join(""));if(hasChild){entryDiv.append(packDiv);that.tree(packDiv,item.children)}elem.append(entryDiv);if(entryDiv.prev("."+ELEM_SET)[0]){entryDiv.prev().children(".layui-tree-pack").addClass("layui-tree-showLine")}if(!hasChild){entryDiv.parent(".layui-tree-pack").addClass("layui-tree-lineExtend")}that.spread(entryDiv,item);if(options.showCheckbox){item.checked&&that.checkids.push(item.id);that.checkClick(entryDiv,item)}options.edit&&that.operate(entryDiv,item)})};Class.prototype.lazytree=function(elem,children){var that=this,options=that.config,id=elem.attr("data-id");var change=function(data){layui.each(data,function(index,e){if(e.id.toString()===id){data[index].children=children;return false}if(e.children&&e.children.length>0){change(e.children)}})};change(options.data);that.loading(elem,true);var packDiv=$('<div class="layui-tree-pack"  style="display: block;"></div>');elem.append(packDiv);that.tree(packDiv,children);if(options.showCheckbox){that.renderForm("checkbox")}};Class.prototype.loading=function(elem,hide){var that=this,options=that.config;if(options.loading){if(hide){that.layInit&&that.layInit.remove();delete that.layInit;that.elem.find(ELEM_INIT).remove()}else{that.layInit=$(['<div class="layui-tree-init" style="height: 20px;">','<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="position: absolute;left: 36px;"></i>',"</div>",].join(""));elem.append(that.layInit)}}};Class.prototype.spread=function(elem,item){var that=this,options=that.config,entry=elem.children("."+ELEM_ENTRY),elemMain=entry.children("."+ELEM_MAIN),elemIcon=entry.find("."+ICON_CLICK),elemText=entry.find("."+ELEM_TEXT),touchOpen=options.onlyIconControl?elemIcon:elemMain,state="";touchOpen.on("click",function(e){if(that.layInit){return false}var packCont=elem.children("."+ELEM_PACK),iconClick=touchOpen.children(".layui-icon")[0]?touchOpen.children(".layui-icon"):touchOpen.find(".layui-tree-icon").children(".layui-icon");if(!packCont[0]){state="normal"}else{if(elem.hasClass(ELEM_SPREAD)){elem.removeClass(ELEM_SPREAD);packCont.slideUp(200);iconClick.removeClass(ICON_SUB).addClass(ICON_ADD)}else{elem.addClass(ELEM_SPREAD);packCont.slideDown(200);iconClick.addClass(ICON_SUB).removeClass(ICON_ADD);if(options.accordion){var sibls=elem.siblings("."+ELEM_SET);sibls.removeClass(ELEM_SPREAD);sibls.children("."+ELEM_PACK).slideUp(200);sibls.find(".layui-tree-icon").children(".layui-icon").removeClass(ICON_SUB).addClass(ICON_ADD)}}}if(state==="normal"&&item.lazy){var _spread=elem.hasClass(ELEM_SPREAD);if(elem.hasClass(ELEM_SPREAD)){elem.removeClass(ELEM_SPREAD);packCont.slideUp(200);iconClick.removeClass(ICON_SUB).addClass(ICON_ADD)}else{elem.addClass(ELEM_SPREAD);packCont.slideDown(200);iconClick.addClass(ICON_SUB).removeClass(ICON_ADD);if(options.accordion){var sibls=elem.siblings("."+ELEM_SET);sibls.removeClass(ELEM_SPREAD);sibls.children("."+ELEM_PACK).slideUp(200);sibls.find(".layui-tree-icon").children(".layui-icon").removeClass(ICON_SUB).addClass(ICON_ADD)}}if(elem.hasClass(ELEM_SPREAD)){state="open"}else{state="close"}options.spread&&options.spread({elem:elem,state:state,data:item});that.loading(elem)}});elemText.on("click",function(){var othis=$(this);if(othis.hasClass(DISABLED)){return}if(elem.hasClass(ELEM_SPREAD)){state=options.onlyIconControl?"open":"close"}else{state=options.onlyIconControl?"close":"open"}options.click&&options.click({elem:elem,state:state,data:item})})};Class.prototype.setCheckbox=function(elem,item,elemCheckbox){var that=this,options=that.config,checked=elemCheckbox.prop("checked");if(elemCheckbox.prop("disabled")){return}if(typeof item.children==="object"||elem.find("."+ELEM_PACK)[0]){var childs=elem.find("."+ELEM_PACK).find('input[same="layuiTreeCheck"]');childs.each(function(){if(this.disabled){return}this.checked=checked})}var setParentsChecked=function(thisNodeElem){if(!thisNodeElem.parents("."+ELEM_SET)[0]){return}var state,parentPack=thisNodeElem.parent("."+ELEM_PACK),parentNodeElem=parentPack.parent(),parentCheckbox=parentPack.prev().find('input[same="layuiTreeCheck"]');if(checked){parentCheckbox.prop("checked",checked)}else{parentPack.find('input[same="layuiTreeCheck"]').each(function(){if(this.checked){state=true}});state||parentCheckbox.prop("checked",false)}setParentsChecked(parentNodeElem)};setParentsChecked(elem);that.renderForm("checkbox")};Class.prototype.checkClick=function(elem,item){var that=this,options=that.config,entry=elem.children("."+ELEM_ENTRY),elemMain=entry.children("."+ELEM_MAIN);elemMain.on("click",'input[same="layuiTreeCheck"]+',function(e){layui.stope(e);var elemCheckbox=$(this).prev(),checked=elemCheckbox.prop("checked");if(elemCheckbox.prop("disabled")){return}if(options.self==null||!options.self){that.setCheckbox(elem,item,elemCheckbox)}options.oncheck&&options.oncheck({elem:elem,checked:checked,data:item})})};Class.prototype.operate=function(elem,item){var that=this,options=that.config,entry=elem.children("."+ELEM_ENTRY),elemMain=entry.children("."+ELEM_MAIN);entry.children(".layui-tree-btnGroup").on("click",".layui-icon",function(e){layui.stope(e);var type=$(this).data("type"),packCont=elem.children("."+ELEM_PACK),returnObj={data:item,type:type,elem:elem};if(type=="add"){if(!packCont[0]){if(options.showLine){elemMain.find("."+ICON_CLICK).addClass("layui-tree-icon");elemMain.find("."+ICON_CLICK).children(".layui-icon").addClass(ICON_ADD).removeClass("layui-icon-file")}else{elemMain.find(".layui-tree-iconArrow").removeClass(HIDE)}elem.append('<div class="layui-tree-pack"></div>')}var key=options.operate&&options.operate(returnObj),obj={};obj.title=options.text.defaultNodeName;obj.id=key;that.tree(elem.children("."+ELEM_PACK),[obj]);if(options.showLine){if(!packCont[0]){var siblings=elem.siblings("."+ELEM_SET),num=1,parentPack=elem.parent("."+ELEM_PACK);layui.each(siblings,function(index,i){if(!$(i).children("."+ELEM_PACK)[0]){num=0}});if(num==1){siblings.children("."+ELEM_PACK).addClass(ELEM_SHOW);siblings.children("."+ELEM_PACK).children("."+ELEM_SET).removeClass(ELEM_LINE_SHORT);elem.children("."+ELEM_PACK).addClass(ELEM_SHOW);parentPack.removeClass(ELEM_EXTEND);parentPack.children("."+ELEM_SET).last().children("."+ELEM_PACK).children("."+ELEM_SET).last().addClass(ELEM_LINE_SHORT)}else{elem.children("."+ELEM_PACK).children("."+ELEM_SET).addClass(ELEM_LINE_SHORT)}}else{if(!packCont.hasClass(ELEM_EXTEND)){packCont.addClass(ELEM_EXTEND)}elem.find("."+ELEM_PACK).each(function(){$(this).children("."+ELEM_SET).last().addClass(ELEM_LINE_SHORT)});if(packCont.children("."+ELEM_SET).last().prev().hasClass(ELEM_LINE_SHORT)){packCont.children("."+ELEM_SET).last().prev().removeClass(ELEM_LINE_SHORT)}else{packCont.children("."+ELEM_SET).last().removeClass(ELEM_LINE_SHORT)}if(!elem.parent("."+ELEM_PACK)[0]&&elem.next()[0]){packCont.children("."+ELEM_SET).last().removeClass(ELEM_LINE_SHORT)}}}if(!options.showCheckbox){return}if(elemMain.find('input[same="layuiTreeCheck"]')[0].checked){var packLast=elem.children("."+ELEM_PACK).children("."+ELEM_SET).last();packLast.find('input[same="layuiTreeCheck"]')[0].checked=true}that.renderForm("checkbox")}else{if(type=="update"){var text=elemMain.children("."+ELEM_TEXT).html();elemMain.children("."+ELEM_TEXT).html("");elemMain.append('<input type="text" class="layui-tree-editInput">');elemMain.children(".layui-tree-editInput").val(text).focus();var getVal=function(input){var textNew=input.val().trim();textNew=textNew?textNew:options.text.defaultNodeName;input.remove();elemMain.children("."+ELEM_TEXT).html(textNew);returnObj.data.title=textNew;options.operate&&options.operate(returnObj)};elemMain.children(".layui-tree-editInput").blur(function(){getVal($(this))});elemMain.children(".layui-tree-editInput").on("keydown",function(e){if(e.keyCode===13){e.preventDefault();getVal($(this))}})}else{layer.confirm('确认删除该节点 "<span style="color: #999;">'+(item.title||"")+'</span>" 吗？',function(index){options.operate&&options.operate(returnObj);returnObj.status="remove";layer.close(index);if(!elem.prev("."+ELEM_SET)[0]&&!elem.next("."+ELEM_SET)[0]&&!elem.parent("."+ELEM_PACK)[0]){elem.remove();that.elem.append(that.elemNone);return}if(elem.siblings("."+ELEM_SET).children("."+ELEM_ENTRY)[0]){if(options.showCheckbox){var elemDel=function(elem){if(!elem.parents("."+ELEM_SET)[0]){return}var siblingTree=elem.siblings("."+ELEM_SET).children("."+ELEM_ENTRY),parentTree=elem.parent("."+ELEM_PACK).prev(),checkState=parentTree.find('input[same="layuiTreeCheck"]')[0],state=1,num=0;if(checkState.checked==false){siblingTree.each(function(i,item1){var input=$(item1).find('input[same="layuiTreeCheck"]')[0];if(input.checked==false&&!input.disabled){state=0}if(!input.disabled){num=1}});if(state==1&&num==1){checkState.checked=true;that.renderForm("checkbox");elemDel(parentTree.parent("."+ELEM_SET))}}};elemDel(elem)}if(options.showLine){var siblings=elem.siblings("."+ELEM_SET),num=1,parentPack=elem.parent("."+ELEM_PACK);layui.each(siblings,function(index,i){if(!$(i).children("."+ELEM_PACK)[0]){num=0}});if(num==1){if(!packCont[0]){parentPack.removeClass(ELEM_EXTEND);siblings.children("."+ELEM_PACK).addClass(ELEM_SHOW);siblings.children("."+ELEM_PACK).children("."+ELEM_SET).removeClass(ELEM_LINE_SHORT)}if(!elem.next()[0]){elem.prev().children("."+ELEM_PACK).children("."+ELEM_SET).last().addClass(ELEM_LINE_SHORT)}else{parentPack.children("."+ELEM_SET).last().children("."+ELEM_PACK).children("."+ELEM_SET).last().addClass(ELEM_LINE_SHORT)}if(!elem.next()[0]&&!elem.parents("."+ELEM_SET)[1]&&!elem.parents("."+ELEM_SET).eq(0).next()[0]){elem.prev("."+ELEM_SET).addClass(ELEM_LINE_SHORT)}}else{if(!elem.next()[0]&&elem.hasClass(ELEM_LINE_SHORT)){elem.prev().addClass(ELEM_LINE_SHORT)}}}}else{var prevDiv=elem.parent("."+ELEM_PACK).prev();if(options.showLine){prevDiv.find("."+ICON_CLICK).removeClass("layui-tree-icon");prevDiv.find("."+ICON_CLICK).children(".layui-icon").removeClass(ICON_SUB).addClass("layui-icon-file");var pare=prevDiv.parents("."+ELEM_PACK).eq(0);pare.addClass(ELEM_EXTEND);pare.children("."+ELEM_SET).each(function(){$(this).children("."+ELEM_PACK).children("."+ELEM_SET).last().addClass(ELEM_LINE_SHORT)})}else{prevDiv.find(".layui-tree-iconArrow").addClass(HIDE)}elem.parents("."+ELEM_SET).eq(0).removeClass(ELEM_SPREAD);elem.parent("."+ELEM_PACK).remove()}elem.remove()})}}})};Class.prototype.events=function(){var that=this,options=that.config,checkWarp=that.elem.find(".layui-tree-checkedFirst");that.setChecked(that.checkids);that.elem.find(".layui-tree-search").on("keyup",function(){var input=$(this),val=input.val(),pack=input.nextAll(),arr=[];pack.find("."+ELEM_TEXT).each(function(){var entry=$(this).parents("."+ELEM_ENTRY);if($(this).html().indexOf(val)!=-1){arr.push($(this).parent());var select=function(div){div.addClass("layui-tree-searchShow");if(div.parent("."+ELEM_PACK)[0]){select(div.parent("."+ELEM_PACK).parent("."+ELEM_SET))}};select(entry.parent("."+ELEM_SET))}});pack.find("."+ELEM_ENTRY).each(function(){var parent=$(this).parent("."+ELEM_SET);if(!parent.hasClass("layui-tree-searchShow")){parent.addClass(HIDE)}});if(pack.find(".layui-tree-searchShow").length==0){that.elem.append(that.elemNone)}options.onsearch&&options.onsearch({elem:arr})});that.elem.find(".layui-tree-search").on("keydown",function(){$(this).nextAll().find("."+ELEM_ENTRY).each(function(){var parent=$(this).parent("."+ELEM_SET);parent.removeClass("layui-tree-searchShow "+HIDE)});if($(".layui-tree-emptyText")[0]){$(".layui-tree-emptyText").remove()}})};Class.prototype.getChecked=function(){var that=this,options=that.config,checkId=[],checkData=[];that.elem.find(".layui-form-checked").each(function(){checkId.push($(this).prev()[0].value)});var eachNodes=function(data,checkNode){layui.each(data,function(index,item){var checkBla=true;layui.each(checkId,function(index2,item2){var cloneItem=$.extend({},item);if(item.id==item2){checkBla=false;delete cloneItem.children;checkNode.push(cloneItem);if(item.children){cloneItem.children=[];if(options.self==null||!options.self){eachNodes(item.children,cloneItem.children)}else{eachNodes(item.children,checkNode)}}return true}});if(checkBla){eachNodes(item.children,checkNode)}})};eachNodes($.extend({},options.data),checkData);return checkData};Class.prototype.setChecked=function(checkedId){var that=this,options=that.config;that.elem.find("."+ELEM_SET).each(function(i,item){var thisId=$(this).data("id"),input=$(item).children("."+ELEM_ENTRY).find('input[same="layuiTreeCheck"]'),reInput=input.next();if(typeof checkedId==="number"){if(thisId==checkedId){if(!input[0].checked){reInput.click()}return false}}else{if(typeof checkedId==="object"){layui.each(checkedId,function(index,value){if(value==thisId&&!input[0].checked){reInput.click();return true}})}}})};thisModule.that={};thisModule.config={};tree.reload=function(id,options){var that=thisModule.that[id];that.reload(options);return thisModule.call(that)};tree.getChecked=function(id){var that=thisModule.that[id];return that.getChecked()};tree.setChecked=function(id,checkedId){var that=thisModule.that[id];return that.setChecked(checkedId)};tree.lazytree=function(id,elem,children){var that=thisModule.that[id];return that.lazytree(elem,children)};tree.render=function(options){var inst=new Class(options);return thisModule.call(inst)};exports(MOD_NAME,tree)});